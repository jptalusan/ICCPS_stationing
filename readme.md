# Stationing Simulator for MCTS

## Contents
0. [Setting up workspace](#workspace)
1. [Generate models](#generate-models)
2. [Usage](#usage)

## Workspace
1. Clone the repo:
    ``` bash
    git clone https://github.com/jptalusan/mta_simulator_redo.git
    git checkout dispatch_heuristic
    ```
2. Download the required files (will just put a google drive link probably):
    * apc_weather_gtfs_20220921.parquet: combined dataset of APC, weather and GTFS ([see here to generate](https://github.com/jptalusan/wego_occupancy_clean/blob/main/notebooks/preprocessing.ipynb))
    * occupancy prediction models: generated by running same_day.ipynb in the link above. 
    * School Breaks (2019-2022).pkl
    * US Holiday Dates (2004-2021).csv

## Generate models
1. Generate required files using:
    * `data_generation/step0_generator.ipynb`: You will need to run `pair_tt_dd.py` and `generate_day_trips.py` as part of this.
    * This also generates the config files which will add files to `results/test_data`. Run this part last.
2. Run `data_generation/generate_day_trips.py`: This will generate the following files that will be used for simulations:
    * `data_generation/results/test_data/YYMMDD/chains/ons_offs_dict_chain_YYMMDD_X.pkl`: used for stochasticity
    * `data_generation/results/test_data/YYMMDD/sampled_ons_offs_dict_20211001.pkl`: used as the "real world" passenger model, but based on generative model as well.
    * `data_generation/results/test_data/YYMMDD/trip_plan_20211001.json`: trip schedules for the day YYMMDD
    * `data_generation/results/test_data/YYMMDD/vehicle_plan_20211001.json`: vehicle trip assignments and capacities for the day YYMMDD
3. Generate depots:
    * `data_generation/stops_clustering.ipynb`

## Usage
1. Create a copy of the `TEST` folder in `code_root/experiments` and rename.
2. Place generate config files in `FOLDER/configs`.
3. From `code_root/experiments/FOLDER`, run `python run_mcts_no_inject.py -c configs/CONFIG_NAME`
4. Once done, it will generate logs inside `logs`.